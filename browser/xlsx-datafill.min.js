!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).XlsxDataFill=e()}}((function(){return function e(t,n,r){function l(a,i){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!i&&s)return s(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[a]={exports:{}};t[a][0].call(u.exports,(function(e){return l(t[a][1][e]||e)}),u,u.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)l(r[a]);return l}({1:[function(e,t,n){(function(n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o="undefined"!=typeof window?window._:void 0!==n?n._:null,a={templateRegExp:new RegExp(/\{\{([^}]*)\}\}/),fieldSplitter:"|",joinText:",",callbacksMap:{"":function(e){return o.keys(e)}}},i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._opts=o.defaultsDeep({},n,a),this._rowSizes={},this._colSizes={},this._access=t}var t,n,i;return t=e,(n=[{key:"options",value:function(e){return null!==e?(o.merge(this._opts,e),this):this._opts}},{key:"fillData",value:function(e){var t=this,n={};return this.collectTemplates((function(e){var r={template:e,dependents:[],processed:!1};if(e.reference){var l=n[e.reference];if(!l)throw new Error("Unable to find a reference '".concat(e.reference,"'!"));l.dependents.push(r),r.offset=t._access.cellDistance(l.template.cell,e.cell)}n[t._access.cellRef(e.cell)]=r})),o.each(n,(function(n){n.processed||t.applyFill(n,e,n.template.cell)})),this}},{key:"getHandler",value:function(e){var t=this._opts.callbacksMap[e];if(t){if("function"!=typeof t)throw new Error("Handler '".concat(e,"' is not a function!"));return t}throw new Error("Handler '".concat(e,"' cannot be found!"))}},{key:"parseExtractor",value:function(e){var t=e.split(":"),n=t[1];return 1==t.length?{path:e,handler:null}:{path:t[0],handler:this.getHandler(n)}}},{key:"applyDataStyle",value:function(e,t,n){var r=this,l=n.styles;return l&&t&&o.each(l,(function(n){if(o.startsWith(n.name,":"))r.getHandler(n.name.substr(1))(t,e,r._opts);else{var l=r.extractValues(t,n.extractor,e);l&&r._access.setStyle(e,n.name,l)}})),this}},{key:"parseTemplate",value:function(e){var t=(this._access.cellValue(e)||"").match(this._opts.templateRegExp);if(!t)return null;var n=t[1].split(this._opts.fieldSplitter).map(o.trim),r=n[4]?n[4].split(","):null;if(n.length<2)throw new Error("Not enough components of the template ".concat(t[0]));return{reference:this._access.buildRef(e,n[0]),iterators:n[1].split(/x|\*/).map(o.trim),extractor:n[2]||"",cell:e,cellSize:this._access.cellSize(e),padding:(n[3]||"").split(/:|,|x|\*/).map((function(e){return parseInt(e)||0})),styles:r?o.map(r,(function(e){var t=o.trim(e).split("=");return{name:o.trim(t[0]),extractor:o.trim(t[1])}})):null}}},{key:"collectTemplates",value:function(e){var t=this,n=[];return this._access.forAllCells((function(e){var r=t.parseTemplate(e);r&&n.push(r)})),n.sort((function(e,n){return e.reference==t._access.cellRef(n.cell)?1:n.reference==t._access.cellRef(e.cell)?-1:0})).forEach(e)}},{key:"extractValues",value:function(e,t,n){var r=this,l=this.parseExtractor(t),a=l.path,i=l.handler;if(Array.isArray(e)){if(void 0!==e.sizes)e=t?o.map(e,(function(e){return r.extractValues(e,t,n)})):e;else if(!i)return e.join(this._opts.joinText||",")}else e=o.get(e,a,e);return i?i(e,n,this._opts):e}},{key:"extractData",value:function(e,t,n){var l=this,a=t[n],i=[],s=!1,c=null;if("1"==a&&(s=!0,a=t[++n]),!a)return e;var u=this.parseExtractor(a);if(c=o.get(e,u.path,e),"function"==typeof u.handler&&(c=u.handler.call(null,c,null,this._opts)),n<t.length-1?i=(c=o.map(c,(function(e){return l.extractData(e,t,n+1)})))[0].sizes:Array.isArray(c)||"object"!==r(c)||(c=o.values(c)),!c)throw new Error("The iterator '".concat(a,"' extracted no data!"));if("object"!==r(c))throw new Error("The data extracted from iterator '".concat(a,"' is neither an array, nor object!"));return i.unshift(s?-c.length:c.length),c.sizes=i,c}},{key:"putValues",value:function(e,t,n){var r=this,l=t.sizes,a=this.extractValues(t,n.extractor,e);if(l&&l.length){if(!(l.length<=2))throw new Error("Values extracted with '".concat(n.extractor," are more than 2 dimension!'"));l[0]<0?(l=[1,-l[0]],a=[a]):1==l.length&&(l=l.concat([1]),a=o.chunk(a,1)),this._access.getCellRange(e,l[0]-1,l[1]-1).forEach((function(e,l,o){r._access.setValue(e,a[l][o]).copyStyle(e,n.cell).copySize(e,n.cell),r.applyDataStyle(e,t[l][o],n)}))}else this._access.setValue(e,a).copyStyle(e,n.cell).copySize(e,n.cell),this.applyDataStyle(e,t,n),l=n.cellSize;return l}},{key:"applyFill",value:function(e,t,n){var r=this,l=e.template,a=this.extractData(t,l.iterators,0),i=[1,1];if(e.dependents&&e.dependents.length){for(var s=n,c=function(e,t){return i[t]=Math.max(i[t],e)},u=0;u<a.length;++u){for(var f=a[u],h=0;h<e.dependents.length;++h){var p=e.dependents[h],d=this._access.offsetCell(s,p.offset[0],p.offset[1]),y=this.applyFill(p,f,d);o.forEach(y,c),p.processed=!0}o.forEach(this.putValues(s,f,l),c);var v=i[0],m=i[1];if(a.sizes[0]<0?(v=0,i[1]=1):(m=0,i[0]=1),v>1||m>1){var w=this._access.getCellRange(s,Math.max(v-1,0),Math.max(m-1,0));this._access.setRangeMerged(w,!0),w.forEach((function(e){return r._access.copySize(e,l.cell)}))}s=this._access.offsetCell(s,v+l.padding[0],m+l.padding[1]||0)}o.forEach(this._access.cellDistance(n,s),c)}else i=this.putValues(n,a,l);return i}}])&&l(t.prototype,n),i&&l(t,i),e}();i.XlsxPopulateAccess=e("./XlsxPopulateAccess"),t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./XlsxPopulateAccess":2}],2:[function(e,t,n){(function(e){"use strict";function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r="undefined"!=typeof window?window._:void 0!==e?e._:null,l=null,o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._workbook=t,this._rowSizes={},this._colSizes={},l=n.RichText}var t,o,a;return t=e,(o=[{key:"workbook",value:function(){return this._workbook}},{key:"cellValue",value:function(e){var t=e.value();return t instanceof l?t.text():t}},{key:"cellDistance",value:function(e,t){return[t.rowNumber()-e.rowNumber(),t.columnNumber()-e.columnNumber()]}},{key:"cellSize",value:function(e){var t=this,n=e.address(),l=[1,1];return r.forEach(e.sheet()._mergeCells,(function(r){var o=r.attributes.ref.split(":");if(o[0]==n)return++(l=t.cellDistance(e,e.sheet().cell(o[1])))[0],++l[1],!1})),l}},{key:"cellRef",value:function(e){return e.address({includeSheetName:!0})}},{key:"buildRef",value:function(e,t){return t?e.sheet().cell(t).address({includeSheetName:!0}):null}},{key:"getCell",value:function(e,t){return(null==t?this._workbook.activeSheet():this._workbook.sheet(t)).cell(e)}},{key:"getCellRange",value:function(e,t,n){return e.rangeTo(e.relativeCell(t,n))}},{key:"offsetCell",value:function(e,t,n){return e.relativeCell(t,n)}},{key:"setRangeMerged",value:function(e,t){return e.merged(t),this}},{key:"forAllCells",value:function(e){return this._workbook.sheets().forEach((function(t){return t.usedRange().forEach(e)})),this}},{key:"copyStyle",value:function(e,t){return t==e?this:(void 0!==t._style?e.style(t._style):t._styleId>0&&(e._styleId=t._styleId),this)}},{key:"copySize",value:function(e,t){var n=e.rowNumber(),r=e.columnNumber();return void 0===this._rowSizes[n]&&e.row().height(this._rowSizes[n]=t.row().height()),void 0===this._colSizes[r]&&e.column().width(this._colSizes[r]=t.column().width()),this}},{key:"setValue",value:function(e,t){return e.value(t),this}},{key:"setStyle",value:function(e,t,n){return e.style(t,n),this}}])&&n(t.prototype,o),a&&n(t,a),e}();t.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)}));
//# sourceMappingURL=xlsx-datafill.min.js.map
