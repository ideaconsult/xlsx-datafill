!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).XlsxDataFill=e()}}((function(){return function e(t,r,n){function l(a,i){if(!r[a]){if(!t[a]){var o="function"==typeof require&&require;if(!i&&o)return o(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[a]={exports:{}};t[a][0].call(u.exports,(function(e){return l(t[a][1][e]||e)}),u,u.exports,e,t,r,n)}return r[a].exports}for(var s="function"==typeof require&&require,a=0;a<n.length;a++)l(n[a]);return l}({1:[function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=e("lodash"),a={templateRegExp:new RegExp(/\{\{([^}]*)\}\}/),fieldSplitter:"|",joinText:",",callbacksMap:{"":function(e){return s.keys(e)}}},i=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._opts=s.defaultsDeep({},r,a),this._rowSizes={},this._colSizes={},this._access=t}var t,r,i;return t=e,(r=[{key:"options",value:function(e){return null!==e?(s.merge(this._opts,e),this._access.options(this._opts),this):this._opts}},{key:"parseExtractor",value:function(e){var t=e.split(":");return 1==t.length?{path:e,handler:null}:{path:t[0],handler:this._opts.callbacksMap[t[1]]}}},{key:"applyDataStyle",value:function(e,t,r){var n=this,l=r.styles;return l&&t&&s.each(l,(function(r){if(s.startsWith(r.name,":")){var l=n._opts.callbacksMap[r.name.substr(1)];"function"==typeof l&&l(t,e,n._opts)}else{var a=n.extractValues(t,r.extractor);a&&n._access.setStyle(e,r.name,a)}})),this}},{key:"parseTemplate",value:function(e){var t=(this._access.cellTextValue(e)||"").match(this._opts.templateRegExp);if(!t)return null;var r=t[1].split(this._opts.fieldSplitter).map(s.trim),n=r[1].split(/x|\*/).map(s.trim),l=r[4]?r[4].split(","):null;return{reference:s.trim(r[0]),iterators:n,extractor:r[2]||"",cell:e,cellSize:this._access.cellSize(e),padding:(r[3]||"").split(/:|,|x|\*/).map((function(e){return parseInt(e)||0})),styles:l?s.map(l,(function(e){var t=s.trim(e).split("=");return{name:s.trim(t[0]),extractor:s.trim(t[1])}})):null}}},{key:"collectTemplates",value:function(e){var t=this,r=[];return this._access.forAllCells((function(e){var n=t.parseTemplate(e);n&&r.push(n)})),r.sort((function(e,t){return e.reference==t.cell.address()?1:t.reference==e.cell.address()?-1:0})).forEach(e)}},{key:"extractValues",value:function(e,t){var r=this,n=this.parseExtractor(t),l=n.path,a=n.handler;if(Array.isArray(e)){if(void 0!==e.sizes)e=t?s.map(e,(function(e){return r.extractValues(e,t)})):e;else if(!a)return e.join(this._opts.joinText||",")}else e=s.get(e,l,e);return a?a(e,null,this._opts):e}},{key:"extractData",value:function(e,t,r){var l=this,a=t[r],i=[],o=!1,c=null;if("1"==a&&(o=!0,a=t[++r]),!a)return e;var u=this.parseExtractor(a);return c=s.get(e,u.path,e),"function"==typeof u.handler&&(c=u.handler.call(null,c,null,this._opts)),r<t.length-1?i=(c=s.map(c,(function(e){return l.extractData(e,t,r+1)})))[0].sizes:Array.isArray(c)||"object"!==n(c)||(c=s.values(c)),i.unshift(o?-c.length:c.length),c.sizes=i,c}},{key:"putValues",value:function(e,t,r){var n=this,l=t.sizes,a=this.extractValues(t,r.extractor);return l&&l.length?l.length<=2&&(l[0]<0?(l=[1,-l[0]],a=[a]):1==l.length&&(l=l.concat([1]),a=s.chunk(a,1)),this._access.getCellRange(e,l[0]-1,l[1]-1).forEach((function(e,l,s){n._access.setValue(e,a[l][s]).copyStyle(e,r.cell).copySize(e,r.cell),n.applyDataStyle(e,t[l][s],r)}))):(this._access.setValue(e,a).copyStyle(e,r.cell).copySize(e,r.cell),this.applyDataStyle(e,t,r),l=r.cellSize),l}},{key:"applyFill",value:function(e,t,r){var n=this,l=e.template,a=this.extractData(t,l.iterators,0),i=[1,1];if(e.dependents&&e.dependents.length){for(var o=r,c=function(e,t){return i[t]=Math.max(i[t],e)},u=0;u<a.length;++u){for(var f=a[u],p=0;p<e.dependents.length;++p){var h=e.dependents[p],y=o.relativeCell(h.offset[0],h.offset[1]),d=this.applyFill(h,f,y);s.forEach(d,c),h.processed=!0}s.forEach(this.putValues(o,f,l),c);var v=i[0],m=i[1];if(a.sizes[0]<0?(v=0,i[1]=1):(m=0,i[0]=1),v>1||m>1){var _=this._access.getCellRange(o,Math.max(v-1,0),Math.max(m-1,0));this._access.setRangeMerged(_,!0),_.forEach((function(e){return n._access.copySize(e,l.cell)}))}o=o.relativeCell(v+l.padding[0],m+l.padding[1]||0)}s.forEach(this._access.cellDistance(r,o),c)}else i=this.putValues(r,a,l);return i}},{key:"fillData",value:function(e){var t=this,r={};return this.collectTemplates((function(e){var n={template:e,dependents:[],processed:!1};if(e.reference){var l=r[e.reference];l.dependents.push(n),n.offset=t._access.cellDistance(l.template.cell,e.cell)}r[e.cell.address()]=n})),s.each(r,(function(r){r.processed||t.applyFill(r,e,r.template.cell)})),this}}])&&l(t.prototype,r),i&&l(t,i),e}();i.XlsxPopulateAccess=e("./XlsxPopulateAccess"),t.exports=i},{"./XlsxPopulateAccess":2,lodash:void 0}],2:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=e("lodash"),s=null,a=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._workbook=t,this._rowSizes={},this._colSizes={},s=r.RichText}var t,r,a;return t=e,(r=[{key:"workbook",value:function(){return this._workbook}},{key:"cellTextValue",value:function(e){var t=e.value();return t instanceof s?t.text():t}},{key:"cellDistance",value:function(e,t){return[t.rowNumber()-e.rowNumber(),t.columnNumber()-e.columnNumber()]}},{key:"cellSize",value:function(e){var t=this,r=e.address(),n=[1,1];return l.forEach(e.sheet()._mergeCells,(function(l){var s=l.attributes.ref.split(":");if(s[0]==r)return++(n=t.cellDistance(e,e.sheet().cell(s[1])))[0],++n[1],!1})),n}},{key:"getCell",value:function(e,t){return(null==t?this._workbook.activeSheet():this._workbook.sheet(t)).cell(e)}},{key:"getCellRange",value:function(e,t,r){return e.rangeTo(e.relativeCell(t,r))}},{key:"setRangeMerged",value:function(e,t){return e.merged(t),this}},{key:"forAllCells",value:function(e){return this._workbook.sheets().forEach((function(t){return t.usedRange().forEach(e)})),this}},{key:"copyStyle",value:function(e,t){return t==e?this:(e._styleId=t._styleId,t._style&&(e._style=l.merge({},t._style)),this)}},{key:"copySize",value:function(e,t){var r=e.rowNumber(),n=e.columnNumber();return void 0===this._rowSizes[r]&&e.row().height(this._rowSizes[r]=t.row().height()),void 0===this._colSizes[n]&&e.column().width(this._colSizes[n]=t.column().width()),this}},{key:"setValue",value:function(e,t){return e.value(t),this}},{key:"setStyle",value:function(e,t,r){return e.style(t,r),this}}])&&n(t.prototype,r),a&&n(t,a),e}();t.exports=a},{lodash:void 0}]},{},[1])(1)}));
//# sourceMappingURL=xlsx-datafill.min.js.map
