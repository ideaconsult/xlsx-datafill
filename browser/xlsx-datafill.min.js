!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).XlsxDataFill=e()}}((function(){return function e(t,r,l){function n(a,s){if(!r[a]){if(!t[a]){var i="function"==typeof require&&require;if(!s&&i)return i(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[a]={exports:{}};t[a][0].call(u.exports,(function(e){return n(t[a][1][e]||e)}),u,u.exports,e,t,r,l)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<l.length;a++)n(l[a]);return n}({1:[function(e,t,r){(function(r){"use strict";function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var o="undefined"!=typeof window?window._:void 0!==r?r._:null,a={templateRegExp:/\{\{([^}]*)\}\}/,fieldSplitter:"|",joinText:",",mergeCells:!0,followFormulae:!1,callbacksMap:{"":function(e){return o.keys(e)}}},s=/('?([^!]*)?'?!)?([A-Z]+\d+)(:([A-Z]+\d+))?/,i=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._opts=o.defaultsDeep({},r,a),this._rowSizes={},this._colSizes={},this._access=t}var t,r,i;return t=e,(r=[{key:"options",value:function(e){return null!==e?(o.merge(this._opts,e),this):this._opts}},{key:"fillData",value:function(e){var t=this,r={};return this.collectTemplates((function(e){var l={template:e,dependents:[],formulas:[],processed:!1};if(e.reference){var n=r[e.reference];if(!n)throw new Error("Unable to find a reference '".concat(e.reference,"'!"));e.formula?n.formulas.push(l):n.dependents.push(l),l.offset=t._access.cellDistance(n.template.cell,e.cell)}r[t._access.cellRef(e.cell)]=l})),o.each(r,(function(r){if(!r.processed){if(r.template.formula)throw new Error("Non-referencing formula found '".concat(r.extractor,"'. Use a non-templated one!"));t.applyFill(r,e,r.template.cell)}})),this}},{key:"getHandler",value:function(e){var t=this._opts.callbacksMap[e];if(t){if("function"!=typeof t)throw new Error("Handler '".concat(e,"' is not a function!"));return t}throw new Error("Handler '".concat(e,"' cannot be found!"))}},{key:"parseExtractor",value:function(e){var t=e.split(":"),r=t[1];return 1==t.length?{path:e,handler:null}:{path:t[0],handler:this.getHandler(r)}}},{key:"applyDataStyle",value:function(e,t,r){var l=this,n=r.styles;return n&&t&&o.each(n,(function(r){if(o.startsWith(r.name,":"))l.getHandler(r.name.substr(1)).call(l._opts,t,e);else{var n=l.extractValues(t,r.extractor,e);n&&l._access.cellStyle(e,r.name,n)}})),this}},{key:"parseTemplate",value:function(e){var t=this._access.cellValue(e);if(null==t||"string"!=typeof t)return null;var r=t.match(this._opts.templateRegExp);if(!r||!this._opts.followFormulae&&"formula"===this._access.cellType(e))return null;var l=r[1].split(this._opts.fieldSplitter).map(o.trim),n=l[4]?l[4].split(","):null,a=l[2]||"";if(l.length<2)throw new Error("Not enough components of the template '".concat(r[0],"'"));return{reference:this._access.buildRef(e,l[0]),iterators:l[1].split(/x|\*/).map(o.trim),extractor:a,formula:a.startsWith("="),cell:e,cellSize:this._access.cellSize(e),padding:(l[3]||"").split(/:|,|x|\*/).map((function(e){return parseInt(e)||0})),styles:n?o.map(n,(function(e){var t=o.trim(e).split("=");return{name:o.trim(t[0]),extractor:o.trim(t[1])}})):null}}},{key:"collectTemplates",value:function(e){var t=this,r=[];return this._access.forAllCells((function(e){var l=t.parseTemplate(e);l&&r.push(l)})),r.sort((function(e,r){return e.reference==t._access.cellRef(r.cell)>-1?1:r.reference==t._access.cellRef(e.cell)>-1?-1:0})).forEach(e)}},{key:"extractValues",value:function(e,t,r){var l=this,n=this.parseExtractor(t),a=n.path,s=n.handler;if(Array.isArray(e)){if(void 0!==e.sizes)e=t?o.map(e,(function(e){return l.extractValues(e,t,r)})):e;else if(!s)return e.join(this._opts.joinText||",")}else e=o.get(e,a,e);return s?s.call(this._opts,e,r):e}},{key:"extractData",value:function(e,t,r){var n=this,a=t[r],s=[],i=!1,c=null;if("1"==a&&(i=!0,a=t[++r]),!a)return e;var u=this.parseExtractor(a);if(c=o.get(e,u.path,e),"function"==typeof u.handler&&(c=u.handler.call(this._opts,c)),r<t.length-1?s=(c=o.map(c,(function(e){return n.extractData(e,t,r+1)})))[0].sizes:Array.isArray(c)||"object"!==l(c)||(c=o.values(c)),!c)throw new Error("The iterator '".concat(a,"' extracted no data!"));if("object"!==l(c))throw new Error("The data extracted from iterator '".concat(a,"' is neither an array, nor object!"));return s.unshift(i?-c.length:c.length),c.sizes=s,c}},{key:"putValues",value:function(e,t,r){var l=this,n=t.sizes,a=this.extractValues(t,r.extractor,e);if(n&&n.length){if(!(n.length<=2))throw new Error("Values extracted with '".concat(r.extractor," are more than 2 dimension!'"));n[0]<0?(n=[1,-n[0]],a=[a],t=[t]):1==n.length&&(n=n.concat([1]),a=o.chunk(a,1),t=o.chunk(t,1)),this._access.getCellRange(e,n[0]-1,n[1]-1).forEach((function(e,n,o){l._access.cellValue(e,a[n][o]).copyStyle(e,r.cell).copySize(e,r.cell),l.applyDataStyle(e,t[n][o],r)}))}else this._access.cellValue(e,a).copyStyle(e,r.cell).copySize(e,r.cell),this.applyDataStyle(e,t,r),n=r.cellSize;return n}},{key:"applyFill",value:function(e,t,r){var l=this,n=e.template,a=this.extractData(t,n.iterators,0),s=[1,1];if(e.dependents&&e.dependents.length){for(var i=r,c=function(e,t){return s[t]=Math.max(s[t],e)},u=0;u<a.length;++u){for(var f=a[u],h=0;h<e.dependents.length;++h){var p=e.dependents[h],d=this._access.offsetCell(i,p.offset[0],p.offset[1]);o.forEach(this.applyFill(p,f,d),c)}o.forEach(this.putValues(i,f,n),c);var y=s[0],m=s[1];if(a.sizes[0]<0?(y=0,s[1]=1):(m=0,s[0]=1),y>1||m>1){var v=this._access.getCellRange(i,Math.max(y-1,0),Math.max(m-1,0));(!0===this._opts.mergeCells||"both"===this._opts.mergeCell||y>1&&"vertical"===this._opts.mergeCells||m>1&&"horizontal"===this._opts.mergeCells)&&this._access.rangeMerged(v,!0),v.forEach((function(e){return l._access.copySize(e,n.cell)}))}i=this._access.offsetCell(i,y+(n.padding[0]||0),m+(n.padding[1]||0))}o.forEach(this._access.cellDistance(r,i),c)}else s=this.putValues(r,a,n);return o.forEach(e.formulas,(function(e){return l.applyFormula(e,s,r)})),e.processed=!0,s}},{key:"shiftFormula",value:function(e,t,r){for(var l="";;){var n=e.match(s);if(!n)break;var o,a=this._access.getCell(n[3],n[2]);t[0]>0&&t[1]>0&&(a=this._access.offsetCell(a,t[0],t[1])),o=n[5]?this._access.rangeRef(this._access.getCellRange(a,r[0],r[1]),!!n[2]):this._access.cellRef(a,!!n[2]),l+=e.substr(0,n.index)+o,e=e.substr(n.index+n[0].length)}return l+=e}},{key:"applyFormula",value:function(e,t,r){r=this._access.offsetCell(r,e.offset[0],e.offset[1]);var l,n=e.template,a=o.trim(n.iterators[0]),s=this._access.cellDistance(n.cell,r),i=n.extractor;if(e.processed=!0,this._access.cellValue(r,null),t[0]<2&&t[1]<2||"all"===a)i=this.shiftFormula(i,s,[0,0]),l=this._access.getCellRange(r,t[0]-1,t[1]-1);else if("cols"===a)i=this.shiftFormula(i,s,[t[0]-1,0]),l=this._access.getCellRange(r,0,t[1]-1);else{if("rows"!==a)return i=this.shiftFormula(i,s,[t[0]-1,t[1]-1]),void this._access.cellFormula(r,i);i=this.shiftFormula(i,s,[0,t[1]-1]),l=this._access.getCellRange(r,t[0]-1,0)}this._access.rangeFormula(l,i)}}])&&n(t.prototype,r),i&&n(t,i),e}();i.XlsxPopulateAccess=e("./XlsxPopulateAccess"),t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./XlsxPopulateAccess":2}],2:[function(e,t,r){(function(e){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n="undefined"!=typeof window?window._:void 0!==e?e._:null,o=null,a=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._workbook=t,this._rowSizes={},this._colSizes={},o=r.RichText}var t,a,s;return t=e,(a=[{key:"workbook",value:function(){return this._workbook}},{key:"cellValue",value:function(e,t){if(void 0!==t)return e.value(t),this;var r=e.value();return r instanceof o?r.text():r}},{key:"cellType",value:function(e){if(e.formula())return"formula";if(e.hyperlink())return"hyperlink";var t=e.value();return t instanceof o?"richtext":t instanceof Date?"date":r(t)}},{key:"cellFormula",value:function(e,t){return void 0!==t?(e.formula(n.trimStart(t," =")),this):e.formula()}},{key:"cellDistance",value:function(e,t){return[t.rowNumber()-e.rowNumber(),t.columnNumber()-e.columnNumber()]}},{key:"cellSize",value:function(e){var t=this,r=e.address(),l=[1,1];return n.forEach(e.sheet()._mergeCells,(function(n){var o=n.attributes.ref.split(":");if(o[0]==r)return++(l=t.cellDistance(e,e.sheet().cell(o[1])))[0],++l[1],!1})),l}},{key:"cellStyle",value:function(e,t,r){return void 0!==r?(e.style(t,r),this):e.style(t)}},{key:"cellRef",value:function(e,t){return null==t&&(t=!0),e.address({includeSheetName:t})}},{key:"buildRef",value:function(e,t,r){return null==r&&(r=!0),t?e.sheet().cell(t).address({includeSheetName:r}):null}},{key:"getCell",value:function(e,t){return(null==t?this._workbook.activeSheet():this._workbook.sheet(t)).cell(e)}},{key:"getCellRange",value:function(e,t,r){return e.rangeTo(e.relativeCell(t,r))}},{key:"offsetCell",value:function(e,t,r){return e.relativeCell(t,r)}},{key:"rangeMerged",value:function(e,t){return void 0===t?e.merged():(e.merged(t),this)}},{key:"rangeFormula",value:function(e,t){return void 0!==t?(e.formula(n.trimStart(t," =")),this):e.formula()}},{key:"rangeRef",value:function(e,t){return null==t&&(t=!0),e.address({includeSheetName:t})}},{key:"forAllCells",value:function(e){return this._workbook.sheets().forEach((function(t){var r=t.usedRange();r&&r.forEach(e)})),this}},{key:"copyStyle",value:function(e,t){return t==e?this:(void 0!==t._style?e.style(t._style):t._styleId>0&&(e._styleId=t._styleId),this)}},{key:"copySize",value:function(e,t){var r=e.rowNumber(),l=e.columnNumber();return void 0===this._rowSizes[r]&&e.row().height(this._rowSizes[r]=t.row().height()),void 0===this._colSizes[l]&&e.column().width(this._colSizes[l]=t.column().width()),this}}])&&l(t.prototype,a),s&&l(t,s),e}();t.exports=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)}));
//# sourceMappingURL=xlsx-datafill.min.js.map
